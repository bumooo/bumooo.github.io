---
title: "아이템12 : toString을 항상 재정의하라"
author: bumoo
date: 2023-01-28 19:53:00 +0900
categories: [이펙티브 자바]
tags: [이펙티브 자바]
---

## toString을 잘 구현한 클래스는 사용하기에 훨씬 즐겁고, 디버깅하기 쉽다.

`Object의 기본 toString`은 `클래스이름@16진수로 표시한 해시코드`를 반환한다. 적합한 문자열을 반환하는 경우는 거의 없다.
`toString`의 일반 규약에 따르면 간결하면서 사람이 읽기 쉬운 형태의 유익한 정보를 반환해야 한다.

`toString` 메소드는 `println`, `printf`, `문자열 연산자(+)`, `assert` 구문 혹은 디버거가 객체를 출력할 때 자동으로 불린다.
직접 호출하지 않아도, 다른 어딘가에 쓰인다. 로깅할 때 자동으로 호출할 수 있다. `toString`을 제대로 정의하지 않으면, 쓸모없는 메시지만 로그에 남게 된다.
```java
System.out.println(phoneNumber + "에 연결할 수 없습니다.");
```
제대로 정의한 경우에 위 코드만으로 제대로된 메시지를 남길 수 있다.
특히 `toString`을 제대로 정의하면 인스턴스를 포함한 객체에서 유용하게 사용된다. 
```java
Map<String, PhoneNumber> map = new HashMap<>();
map.put("Jenny", new PhoneNumber(707, 867, 5309));
System.out.println(map);
```
위 코드를 실행했을 때 `{Jenny=PhoneNumber@adbbd}`보다 `{Jenny=707-867-5309}`가 보기 편하다.
`toString`은 해당 객체가 가진 주요 정보 모두를 반환하는 것이 좋다.
하지만, 객체가 거대하거나, 객체의 상태가 문자열로 표현하기에 적합하지 않다면 무리가 있다.

```
Assertion failure: expected {abc, 123}, but was {abc, 123}
```
위 테스트 실패 메시지는 주요 정보가 담기지 않을 때 문제가 되는 예시이다.

## 포맷을 명시하든 아니든 의도는 명확히 밝혀야 한다.

`toString`을 구현할 때 반환값의 포맷을 문서화할지 정해야 한다. 전화번호나 행렬 같은 값 클래스라면 문서화하기를 권장한다.
포맷을 명시하면 표준적이고, 명확하고, 사람이 읽을 수 있게 된다. 

단점도 있다. 포맷을 정하게 되면, 평생 그 포맷을 사용해야 한다.
만약 해당 포멧을 변경하면, 이를 사용하던 코드들과 데이터들은 엉망이 된다. 반대로 포멧을 명시하지 않는다면 향후에 정보를 더 넣거나 포맷을 개선할 수 있는 유연성을 얻는다.

포맷을 명시하려면 아주 정확하게 해야 한다.
```java
/**
* 이 전화번호의 문자열 표현을 반환한다.
* 이 문자열은 "XXX-YYY-ZZZZ" 형태의 12글자로 구성된다.
* XXX는 지역 코드, YYY는 프리픽스, ZZZZ는 가입자 번호다.
* 각각의 대문자는 10진수 숫자 하나를 나타낸다.
* 
* 각 부분의 값이 너무 작아 자릿수를 채울 수 없다면,
* 앞에서부터 0으로 채워나간다. 가입자 번호가 123이라면 0123으로 표시된다.
*/
@Override
public String toString() {
    return String.format("%03d-%03d-%04d", this.areaCode, this.prefix, this.lineNum);
}
```
위 코드는 phoneNumber 클래스를 포맷에 대한 설명을 작성한 경우이다.
```java
/**
* 약물에 관한 대략적인 설명을 반환한다.
* 일반적인 형태이나, 상세 형식은 정해지지 않았으며 향후 변경될 수 있다.
* "[약물 #9: 유형=사랑, 냄새=테레빈유, 겉모습=먹물]"
*/
@Override
public String toString() { ... }
```
포맷을 명시하지 않기로 했다면 위 처럼 작성하면 된다. 

## toString이 반환한 값에 포함된 정보를 얻어올 수 있는 API를 제공하자.

phoneNumber 클래스는 지역 코드, 프리픽스, 가입자 번호용 접근자를 제공해야 한다. 그렇지 않으면 `toString`의 반환값을 파싱할 수 밖에 없다.
파싱을 하는 경우 성능이 나빠지고, 필요하지도 않는 작업이고, 포맷이 변경된 경우 제대로 작동하지 않는다.

정적 유틸리티 클래스는 `toString`을 제공할 이유가 없고, 열거 타입(Enum)의 경우엔 완벽한 `toString`을 제공한다.
하지만, 하위 클래스들이 공유해야 할 문자열 표현이 있는 추상 클래스라면 `toString`을 재정의해야 한다.