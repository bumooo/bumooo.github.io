---
title: "JVM(Java Virtual Machine)"
author: bumoo
date: 2022-11-11 23:10:00 +0900
categories: [JAVA, JVM]
tags: [JVM]
---

## JVM이란

-   '자바를 실행하기 위한 가상 기계(컴퓨터)
-   Java는 'OS에 종속적이지 않다'는 특징을 가지고 있다.
  -   OS에 종속받지 않고, 실행하기 위해 OS 위 Java를 실행시킬 무언가가 필요 → JVM
-   OS에 종속받지 않고 CPU가 Java를 인식, 실행할 수 있게 하는 가상 컴퓨터이다.

## JVM 역할

-   Java 애플리케이션을 클래스 로더를 통해 읽어 Java API와 함께 실행한다.
-   Java와 OS 사이에 중개자 역할을 수행하여 OS에 구애받지 않고 사용 가능하도록 한다.
-   메모리 관리, GC를 수행한다.

## Java 코드 실행

![Java 코드 실행 과정](https://user-images.githubusercontent.com/61149599/216770127-3aab20a8-17b2-4429-bda9-1ed0dfaa05f2.png)


1.  프로그램이 실행되면 JVM은 OS로부터 이 프로그램에 필요한 메모리를 할당 받는다.
2.  자바 컴파일러(`javac`)가 자바 소스코드(`.java`)를 자바 바이트 코드(`.class`)로 변환한다.
  -   Java 소스코드(`*.java)`는 CPU가 인식하지 못해 기계어로 컴파일을 해야 한다.
  -   Java는 JVM을 거쳐 OS에 도달하기 때문에, OS가 인식할 수 있는 기계어로 컴파일 되는 것이 아닌 JVM이 인식할 수 있는 Java bytecode(`*.class`)로 변환한다.
3.  클래스 로더를 통해 자바 바이트코드(`.class`)를 JVM으로 로딩한다.
4.  로딩된 자바 바이트 코드(`.class`)들을 실행 엔진을 통해 해석한다.
5.  해석된 자바 바이트 코드(`.class`)는 런타임 데이터 영역에 배치되어 실질적인 수행한다.

## JVM의 구조

![JVM 구조](https://user-images.githubusercontent.com/61149599/216770179-cdd612a5-c96b-49ea-96c6-c6eae2f6e11b.png)

### 클래스 로더

-   동적 로드를 담당 하는 역할을 수행
  -   한 번에 메모리에 모든 클래스를 로드하는 것이 아닌, 필요한 순간에 해당 자바 바이트 코드(`.class`) 파일을 찾아 메모리에 로딩

> 동적로드 : 컴파일 타임이 아니라 런타임에 클래스를 로드하고 링크하는 특징
{: .prompt-info }

### 실행 엔진

-   클래스를 실행시키는 역할을 수행
  -   클래스 로더가 JVM내의 런타임 데이터 영역에 바이트 코드를 배치하고, 실행 엔진이 실행한다.
  -   자바 바이트 코드(`*.class`)는 기계가 바로 수행할 수 없기 때문에 실행 엔진이 JVM 내부에서 기계가 실행할 수 있는 형태로 변환한다.
-   실행 엔진이 바이트 코드(`*.class`)를 명령어 단위로 읽어 수행하는데 2가지 방식을 사용한다.
  -   인터프리터
    -   런타임 중에 바이트 코드를 한 줄씩 읽고 실행한다.
    -   컴파일보다 속도가 느리다.
  -   JIT(Ust In Time)
    -   인터프리터의 속도 이슈를 해결하기 위해 같이 사용한다.
    -   자주 실행하는 메소드의 경우 컴파일하고 기계어를 캐싱하여 사용한다.

### 런타임 데이터 영역

![런타임 데이터 영역](https://user-images.githubusercontent.com/61149599/216770268-dc310573-2e5b-40bb-b754-f028fc39b817.png)

- 프로그램을 수행하기 위해 OS에서 할당받은 메모리 공간
  - 스레드마다 하나씩 생성되는 공간
    - PC 레지스터(PC Register)
    - JVM 스택(JVM Stack)
    - 네이티브 메소드 스택(Native Method Stack)
  - 모든 스레드가 공유하는 공간
    - 힙(Heap)
    - 메소드 영역(Method Area)
    - 런타임 상수 풀(Runtime Contatnt Pool)
- PC 레지스터(PC Register)
  - 스레드가 시작될 때 생성한다.
  - 메소드 안에서 바이트 코드 몇 번째 줄을 실행하고 있는지와 같은 정보(JVM 명령의 주소)를 갖는다.
- JVM 스택(JVM Stack)
  - 프로그램 실행과정에서 임시로 할당되었다가 메소드를 빠져나가면 바로 소멸되는 특정의 데이터를 저장하기 위한 영역이다.
    - 각종 형태의 변수나 임시 데이터, 스레드나 메소의 정보를 저장한다.
    - 메소드 안에서 사용되는 값들을 저장한다.
- 네이티브 메소드 스택(Native Method Stack)
  - 자바 바이트 코드가 아닌 다른 언어로 작성된 네이티브 코드를 위한 영역이다.
- 힙(Heap)
  - 프로그램을 실행하면서 생성된 모든 인스턴스 또는 객체를 저장하는 공간
- 메소드 영역(Method Area)
  - 클래스 정보를 처음 메모리 공간에 올릴 때 초기화되는 대상을 저장하기 위한 메모리 공간이다.
- 런타임 상수 풀(Runtime Contatnt Pool)
  - 상수 자료형을 저장하여 참조하고, 중복을 막는 역할을 수행한다.
  - 어떤 메소드나 필드를 참조할 때 JVM은 런타임 상수 풀을 통해 해당 메소드나 필드의 실제 메모리 상세 주소 찾아서 참조한다.

### JDK와 JRE

- JDK(Java Developement Kit : 자바 개발 키트)
  - JRE를 포함하고 있다.
  - JRE에 있는 모든 것 뿐만 아니라 컴파일러(javac)와 jdb, javadoc 같은 도구도 있다.
- JRE(Java Runtime Enviroment : 자바 런타임 환경)
  - JVM + Java Class Library(자바 클래스 라이브러리)등으로 구성
- JDK vs JRE
  - JDK : 자바 프로그램 실행, 컴파일, 개발용 도구
  - JRE : 자바 프로그램 실행 도구
