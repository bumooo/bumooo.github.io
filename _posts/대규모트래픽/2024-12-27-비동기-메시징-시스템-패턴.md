---
title: "비동기 메시징 시스템의 패턴"
author: bumoo
date: 2024-12-27 01:55:00 +0900
categories: ["대규모 트래픽"]
tags: ["비동기 메시징 시스템"]
---


## Event Driven Architecture
![Event-Driven-Architecture](https://github.com/user-attachments/assets/3fd53cd1-7e61-48b8-91ed-4cc0206c86dc)
시스템의 각 구성 요소들이 특정 이벤트에 반응하여 작업을 처리하는 방식

이벤트가 발생하면 다른 서비스나 모듈이 구독하고, 이벤트가 도착하면 해당 작업을 비동기적으로 처리하는 구조

### 구성 요소
`Event Producer` : 이벤트를 발생시키는 주체

`Event Consumer` : 이벤트를 구독하고 처리하는 주체

`Event Broker` : 이벤트를 구독자들에게 전달하는 중개 역할

## CQRS (Command Query Responsibility Segregation)
![CQRS](https://github.com/user-attachments/assets/5d124509-e458-4001-95d0-c01e65dafa8f)
명령(Command)과 조회(Query)를 분리하여 독립적으로 처리하는 아키텍처 패턴

비동기 메시징 시스템과 함께 사용되어 성능과 확장성을 높힐 수 있다.

### 구성 요소
`Command Handlers` : 데이터 변경하는 작업, 메시지 큐를 사용해 명령이 큐에 저장되고, 비동기적으로 처리

`Query Handlers` : 데이터 조회하는 작업, 데이터 조회는 즉각 처리되지만, 명령은 비동기적으로 처리되어 데이터 일관성 유지

`Event Sourcing` : 모든 상태 변경을 이벤트로 기록하고 이벤트를 통해 시스템의 상태를 재구성하는 방식

> 장점
> - 데이터 읽기 쓰기가 분리되어 성능 최적화
> - 쓰기는 비동기여서 시스템 부하 줄임
> - 명령과 조회를 독립적으로 확장 가능
    {: .prompt-info }

## 사가 패턴 (Saga Pattern)
![사가 패턴](https://github.com/user-attachments/assets/36de7ca0-2cdc-43e1-b941-3faacec7e555)
분산 트랜잭션을 처리할 때 사용되는 아키텍처 패턴

각 서비스에서 독립적으로 트랜잭션을 처리하지만, 전체 프로세스는 논리적으로 하나의 트랜잭션처럼 보이게 함

각 서비스에서 처리된 결과를 비동기적으로 전달받아 트랜잭션을 완성하거나 실패시 보상 작업 수행

### 구성 요소
`Saga Coordinator` : 트랜잭션의 시작, 종료를 관리, 트랜잭션 실패시 보상 작업 실행

`Local Transactions` : 각 서비스에서 실행되는 독립적인 트랜잭션, 메시지 큐를 통해 비동기적으로 트랜잭션 결과 전달

> 장점
> - 분산 트랜잭션 가능
> - 여러 서비스가 참여하는 분산 트랜잭션을 일관성있게 처리 가능
> - 분산 트랜잭션 처리를 해서 서비스 간 느슨한 결합 유지
> - 트랜잭션이 비동기로 처리되도 확장성 확보
    {: .prompt-info }

## 백프레셔 패턴 (Backpressure Pattern)
시스템이 과부하 상태일 때 요청을 거부하거나 처리 속도를 늦추는 방식으로 트래픽을 조절하는 아키텍처 패턴

비동기 메시징 시스템과 함께 사용되며 대규모 트래픽 상황에서 시스템의 안정성을 보장하는데 도움

### 구성 요소
`Producer` : 메시지를 생성하여 큐 넣는 역할, 큐가 가득 차면 메시지 생산을 중단하거나 속도를 늦춤

`Consumer` : 메시지를 처리하는 소비자, 큐에서 처리할 수 있는 메시지의 양을 제어하여 시스템 과부하 방지

> 장점
> - 과부하 상태에서도 시스템이 중단되지 않고 안정적으로 작동
> - 비동기적으로 처리되는 메시지 양을 조절해 시스템 장애 예방
    {: .prompt-info }

## 지속 메시징 패턴 (Durable Messaging Pattern)
메시지를 손실 없이 처리할 수 있도록 보장하는 패턴

메시지가 중간에 손실되거나 누락되지 않도록 메시지를 저장, 시스템 장애시에도 복구가 가능한 상태 유지

### 구성 요소
`Persistent Queue` : 메시지를 큐에 영구적으로 저장, 실패 시 재시도될 수 있으며, 시스템이 복구된 후에도 메시지가 손실되지 않음

`Retry Mechanism` : 실패한 메시지를 재처리할 수 있는 매커니즘을 포함하여, 메시지가 손실되지 않도록 보장

> 장점
> - 메시지 손실되지 않고 시스템 장애시에도 복구 가능
> - 시스템 중단된 이후에도 큐에 저장된 메시지를 다시 처리할 수 있어 신뢰성을 높힘
    {: .prompt-info }

